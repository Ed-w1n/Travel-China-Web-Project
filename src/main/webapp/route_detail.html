<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Travel routes' details</title>
    <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="css/common.css">
    <link rel="stylesheet" type="text/css" href="css/route-detail.css">



</head>

<body>
<!--引入头部-->
<div id="header"></div>
    <!-- 详情 start -->
    <div class="wrap">
        <div class="bread_box" id="navi">
            <a href="index.html">Home</a>
            <span> &gt;</span>
            <a href="#">Inbound Tourism</a><span> &gt;</span>
            <a>Entire Nation - Bangkok 6-7 days free travel Thailand outbound travel special round-trip tickets free travel second confirmation</a>
        </div>
        <div class="prosum_box">
            <dl class="prosum_left">
                <dt id="dt">
                    <img alt="" class="big_img" src="http://www.jinmalvyou.com/Public/uploads/goods_img/img_size4/201703/m49788843d72171643297ccc033d9288ee.jpg">
                </dt>
                <dd id="dd">
                    <a class="up_img up_img_disable"></a>
                    <a title="" class="little_img" data-bigpic="http://www.jinmalvyou.com/Public/uploads/goods_img/img_size4/201703/m40920d0669855e745d97f9ad1df966ebb.jpg">
                        <img src="http://www.jinmalvyou.com/Public/uploads/goods_img/img_size2/201703/m20920d0669855e745d97f9ad1df966ebb.jpg">
                    </a>
                    <a title="" class="little_img cur_img" data-bigpic="http://www.jinmalvyou.com/Public/uploads/goods_img/img_size4/201703/m49788843d72171643297ccc033d9288ee.jpg">
                        <img src="http://www.jinmalvyou.com/Public/uploads/goods_img/img_size2/201703/m29788843d72171643297ccc033d9288ee.jpg">
                    </a>
                    <a title="" class="little_img" data-bigpic="http://www.jinmalvyou.com/Public/uploads/goods_img/img_size4/201703/m4531a8dbceefa2c44e6d0e35627cd2689.jpg">
                        <img src="http://www.jinmalvyou.com/Public/uploads/goods_img/img_size2/201703/m2531a8dbceefa2c44e6d0e35627cd2689.jpg">
                    </a>
                    <a title="" class="little_img" data-bigpic="http://www.jinmalvyou.com/Public/uploads/goods_img/img_size4/201703/m46d8cb900e9f6c0a762aca19eae40c00c.jpg">
                        <img src="http://www.jinmalvyou.com/Public/uploads/goods_img/img_size2/201703/m26d8cb900e9f6c0a762aca19eae40c00c.jpg">
                    </a>
                    <a title="" class="little_img" data-bigpic="http://www.jinmalvyou.com/Public/uploads/goods_img/img_size4/201703/m45ea00f6eba562a767b5095bbf8cffe07.jpg" style="display:none;">
                        <img src="http://www.jinmalvyou.com/Public/uploads/goods_img/img_size2/201703/m25ea00f6eba562a767b5095bbf8cffe07.jpg">
                    </a>
                    <a title="" class="little_img" data-bigpic="http://www.jinmalvyou.com/Public/uploads/goods_img/img_size4/201703/m4265ec488cd1bc7ce749bc8c9b34b87bc.jpg" style="display:none;">
                        <img src="http://www.jinmalvyou.com/Public/uploads/goods_img/img_size2/201703/m2265ec488cd1bc7ce749bc8c9b34b87bc.jpg">
                    </a>
                    <a title="" class="little_img" data-bigpic="http://www.jinmalvyou.com/Public/uploads/goods_img/img_size4/201703/m4e7e964909d7dd1a9f6e5494d4dc0c847.jpg" style="display:none;">
                        <img src="http://www.jinmalvyou.com/Public/uploads/goods_img/img_size2/201703/m2e7e964909d7dd1a9f6e5494d4dc0c847.jpg">
                    </a>
                    <a title="" class="little_img" data-bigpic="http://www.jinmalvyou.com/Public/uploads/goods_img/img_size4/201703/m467db00e1b76718fab0fe8b96e10f4d35.jpg" style="display:none;">
                        <img src="http://www.jinmalvyou.com/Public/uploads/goods_img/img_size2/201703/m267db00e1b76718fab0fe8b96e10f4d35.jpg">
                    </a>
                    <a title="" class="little_img" data-bigpic="http://www.jinmalvyou.com/Public/uploads/goods_img/img_size4/201703/m487bbbc6e43eba6aa6a36cc1a182f7a20.jpg" style="display:none;">
                        <img src="http://www.jinmalvyou.com/Public/uploads/goods_img/img_size2/201703/m287bbbc6e43eba6aa6a36cc1a182f7a20.jpg">
                    </a>
                    <a class="down_img down_img_disable" style="margin-bottom: 0;"></a>
                </dd>
            </dl>
            <div class="prosum_right">
               <p class="pros_title" id="rname">[Last sale] nationwide - Bangkok 6-7 days free travel Thailand outbound travel special round-trip tickets free travel second confirmation  </p>
                <p class="hot" id="routeIntroduce">From January to February, you can enjoy ￥1099/2 for online payment!  Explosive location is limited, grab as soon as you finish!</p>
                <div class="pros_other">
                    <p >Provider：<span id="sname">Travel China</span></p>
                    <p >Hotline: <span id="consphone">400-618-9090</span></p>
                    <p >Address： <span id="address">Ottawa, Kanata</span></p>
                </div>
                <div class="pros_price">
                    <p class="price"><span>From </span><strong id="price">¥2699.00</strong></p>
                    <p class="collect">
                        <a class="btn" id="favorite" onclick="addFavorite()"><i class="glyphicon glyphicon-heart-empty"></i>Add to collections</a>

                        <!--<a  class="btn already" disabled="disabled"><i class="glyphicon glyphicon-heart-empty"></i>点击收藏</a>-->
                        <span id="favoriteCount">Collected 100 times</span>
                    </p>
                </div>
            </div>
        </div>
        <div class="you_need_konw">
            <span>Travel Information</span>
            <div class="notice">
                <p>1. The travel agency has covered the travel agency liability insurance.  Tourists are advised to take out travel accident insurance   <br>

                <p>2. Tourists to participate in hunting, diving, swimming, drifting, the sea water skiing, skiing, grass skiing, bungee jumping, parachuting, gliding, in a balloon, horse riding, car racing, rock climbing, spa and seaplane belongs to high risk of rides, visitors please be sure to fully understand the project safety instructions before attending and ensure the physical condition can adapt to such activities;  If the traveler is not equipped with good physical condition and skills, it may cause physical injury.  </p>

                <p>3. Please wear lifesaving equipment when participating in sea activities.  You should pay attention to your physical condition when participating in water sports. You should not participate in water sports or diving if you have heart disease, coronary heart disease, high blood pressure, cold, fever, drinking and after meals.  Do not touch fish, jellyfish, sea urchins, coral and other Marine creatures in the sea to avoid being stung.  The elderly and children must be accompanied by an adult to participate in proper water activities.  When visiting the seaside, take care of your valuables.  </p>

                <p>4. According to the China General Administration of Customs, goods purchased by travelers abroad may be subject to customs duties when they enter Chinese customs.  For details, see Announcement No.54, 2010 of the General Administration of Customs, PRC.  </p>

                <p>5. It is recommended to check your luggage before departure. Please take valuables, common articles, medicines and warm clothes with you, and try not to check them.  The luggage delay is force majeure, we will do our best to assist the customer to follow up the work, but we do not assume any responsibility for this.  </p>
            </div>
        </div>
    </div>
    <!-- 详情 end -->

    <!--引入头部-->
    <div id="footer"></div>
        <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="js/jquery-3.3.1.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="js/bootstrap.min.js"></script>
    <!--导入布局js，共享header和footer-->
    <script type="text/javascript" src="js/include.js"></script>
    <script src="js/getParameter.js"></script>
    <script>
    $(document).ready(function() {

        //自动播放
        goImg();
        // var timer = setInterval("auto_play()", 5000);
    });
    function goImg(){
        //焦点图效果
        //点击图片切换图片
        $('.little_img').on('mousemove', function() {
            $('.little_img').removeClass('cur_img');
            var big_pic = $(this).data('bigpic');
            $('.big_img').attr('src', big_pic);
            $(this).addClass('cur_img');
        });
        //上下切换
        var picindex = 0;
        var nextindex = 4;
        $('.down_img').on('click',function(){
            var num = $('.little_img').length;
            if((nextindex + 1) <= num){
                $('.little_img:eq('+picindex+')').hide();
                $('.little_img:eq('+nextindex+')').show();
                picindex = picindex + 1;
                nextindex = nextindex + 1;
            }
        });
        $('.up_img').on('click',function(){
            var num = $('.little_img').length;
            if(picindex > 0){
                $('.little_img:eq('+(nextindex-1)+')').hide();
                $('.little_img:eq('+(picindex-1)+')').show();
                picindex = picindex - 1;
                nextindex = nextindex - 1;
            }
        });
        var timer = setInterval("auto_play()", 5000);
    }
    //自动轮播方法
    function auto_play() {
        var cur_index = $('.prosum_left dd').find('a.cur_img').index();
        cur_index = cur_index - 1;
        var num = $('.little_img').length;
        var max_index = 3;
        if ((num - 1) < 3) {
            max_index = num - 1;
        }
        if (cur_index < max_index) {
            var next_index = cur_index + 1;
            var big_pic = $('.little_img:eq(' + next_index + ')').data('bigpic');
            $('.little_img').removeClass('cur_img');
            $('.little_img:eq(' + next_index + ')').addClass('cur_img');
            $('.big_img').attr('src', big_pic);
        } else {
            var big_pic = $('.little_img:eq(0)').data('bigpic');
            $('.little_img').removeClass('cur_img');
            $('.little_img:eq(0)').addClass('cur_img');
            $('.big_img').attr('src', big_pic);
        }
    }


    $(function () {
       //1.获取rid
       var rid = getParameter("rid");

       //2.发送请求请求 route/findOne
        $.get("route/findOne",{rid:rid},function (route) {
            //3.解析数据填充html
            $("#rname").html(route.rname);
            $("#routeIntroduce").html(route.routeIntroduce);
            $("#price").html("¥"+route.price);
            $("#sname").html(route.seller.sname);
            $("#consphone").html(route.seller.consphone);
            $("#address").html(route.seller.address);
            //设置收藏次数
            $("#favoriteCount").html("Favorite "+route.count+" times")

            $.get("category/findOne",{cid:route.cid},function (data) {
                var navigator='            <a href="index.html">首页</a>\n' +
                    '            <span> &gt;</span>\n' +
                    '            <a href="route_list.html?cid='+route.cid+'">'+data.cname+'</a><span> &gt;</span>\n' +
                    '            <a>'+route.rname+'</a>';
                $("#navi").html(navigator);
            })


            //图片展示
            var idImg='<img alt="" class="big_img" src="'+route.routeImgList[0].bigPic+'">';
            $("#dt").html(idImg);
            var ddstr = '<a class="up_img up_img_disable"></a>';

            //遍历routeImgList
            for (var i = 0; i < route.routeImgList.length; i++) {
                var astr ;
                if(i >= 4){
                    astr = '<a title="" class="little_img" data-bigpic="'+route.routeImgList[i].bigPic+'" style="display:none;">\n' +
                        '                        <img src="'+route.routeImgList[i].smallPic+'">\n' +
                        '                    </a>';
                }else{
                    astr = '<a title="" class="little_img" data-bigpic="'+route.routeImgList[i].bigPic+'">\n' +
                        '                        <img src="'+route.routeImgList[i].smallPic+'">\n' +
                        '                    </a>';
                }


                ddstr += astr;
            }
            ddstr+='<a class="down_img down_img_disable" style="margin-bottom: 0;"></a>';

            $("#dd").html(ddstr);

            //图片展示和切换代码调用
            goImg();
        });
    });

    $(function () {
      //发送请求，判断用户是否收藏过该路线
        var rid=getParameter("rid");
        $.get("route/isFavorite",{rid:rid},function (flag) {
            if (flag){
                //用户已经收藏过
                //设置收藏按钮的样式
                $("#favorite").addClass("already");
                $("#favorite").attr("disabled","disabled");

                //删除按钮的点击事件
                $("#favorite").removeAttr("onclick");
            }else{
                //用户没有收藏
            }
        });
    });
    //点击收藏按钮触发的按钮
        function addFavorite() {
            var rid=getParameter("rid");
            //1.判断用户是否登录
            $.get("user/findUserServlet",{},function (user) {
                if(user){
                    //用户登录了
                    //添加功能
                    $.get("route/addFavorite",{rid:rid},function () {
                        //代码刷新页面
                        location.reload();
                    });
                }else{
                    alert("please login first");
                    location.href='login.html';
                }
            })
        }
    </script>
</body>

</html>